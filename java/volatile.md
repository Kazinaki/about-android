- [Назад](/./java.md)

## Volatile. ThreadLocal

### Volatile

Потоки в Java устроены так, что при использовании какой то переменной, они могут сохранять ее копию в своем кэше. И таким образом изменение переменной в одном потоке, может быть не видно в другом. Ключевое слово `volatile` в объявлении переменной, говорит о том что при работе с ней локальная копия не создается. Однако это не избавляет от проблем с синхронизацией, дело в том, что только запись и чтение    `volatile` переменной атомарно и т.о. синхронизировано. А например такой код не сихронизирован:

```java
myViolateVar++
```

Потому что операция `++` не атомарная. Для синхронизации этого кода, его надо переписать так:

```java
int temp = 0;
synchronize(myVolatileVar) {
    temp = myVolatileVar;
}
 
temp++;
 
synchronize(myVolatileVar) {
    myVolatileVar = temp;
}
```

### ThreadLocal

Напротив, явно говорит, что надо создать локальную копию для потока и использовать её.
